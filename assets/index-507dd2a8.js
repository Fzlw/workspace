import{P as v,r as k,u as f,o as M,t as I}from"./vue.esm-bundler-2b92b106.js";import{c as p}from"./cloneDeep-bdfe0376.js";import{Z as w}from"./el-message-box-0e7d5819.js";const g=m=>{const{prop:c,formItemProps:i,labelWidth:t,rules:a,requiredMsg:d,...C}=m;return{...C,prop:c,formItemProps:{prop:c,labelWidth:t,rules:a||(d?[{required:!0,message:d}]:void 0),...i}}};function R(m){const c=v(null),i=v(m.columns.map(o=>g(o))),t=k({submitting:!1,model:{},columns:f(i).filter(o=>!o.hidden),ref(o){c.value=o==null?void 0:o.elForm}}),a=o=>{for(const s of f(i))if(s.prop===o)return s;return null},d=(o,s,e)=>{for(const l of f(i))if(l.prop===o){for(const r of m.columns)if(r.prop===o){const n=p(r),u=g(Object.assign(n,s));Object.assign(l,u);break}break}t.columns=t.columns.slice(),w(e)||(t.model[o]=e)},C=(o,s)=>{if(s){const e=g({...s,prop:o.prop,formItemProps:o.formItemProps});Object.assign(o,e)}},h=(o,s)=>{if(!o)return;const e=typeof o=="string"?{[o]:s}:Array.isArray(o)?o.reduce((r,n)=>(n&&(r[n]=s),r),{}):o,l=[];for(const r of f(i)){const n=r.prop,u=n&&n in e?w(e[n])?!r.hidden:!e[n]:r.hidden;r.hidden=u,u||l.push(r)}t.columns=l},y=async o=>{var s;try{t.submitting=!0,(await((s=c.value)==null?void 0:s.validate())??!0)&&o&&await o(p(I(t.model))),t.submitting=!1}catch(e){throw t.submitting=!1,e}},b=(o,s=!1)=>{if(s){const e=[],l=[],r=[];for(const n of f(i))n.prop&&e.push(n.prop);for(const n of m.columns){const u=g(n);u.hidden||l.push(u),r.push(u)}for(const n in t.model)t.model[n]=void 0;t.columns=l,i.value=r,setTimeout(()=>{var n;return(n=c.value)==null?void 0:n.clearValidate(e)},0)}for(const e in o)t.model[e]=p(o[e])},P=o=>t.model[o];return M(()=>{m.initData&&b(p(m.initData))}),{formState:t,getColumn:a,setColumn:d,toggleColumn:h,submit:y,setModel:b,form:c,getModel:P,patchColumn:C,originColumns:i}}export{g as f,R as u};
//# sourceMappingURL=index-507dd2a8.js.map
