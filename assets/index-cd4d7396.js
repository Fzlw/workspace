import{u as x,d as C}from"./index-83833a79.js";import{X as p,Y as v,N as A}from"./el-message-box-dfb8e93c.js";import{Q as I,g as F,u as d}from"./vue.esm-bundler-2b92b106.js";import{c as g}from"./cloneDeep-da0589d6.js";const U=u=>{const{tableState:i,setState:l,...b}=x({mapColumn(t){const{formatter:e,editable:r,...n}=t;return{...n,formatter(a,s,o,f){return(p(r)||r===!0)&&a._editing?v(a,t)??"":e?e(a,s,o,f):C(o,n.rFormat,n.defaultValue)??o??n.defaultValue}}},...u,async query(t){if(!u.query)return{list:[]};const e=await u.query(t);return e.list=e.list.map(r=>{const n=g(r);return Object.assign(r,{_origin:I(n)})}),e}}),h=(t,e)=>{i.columns=i.columns.map(r=>r.prop===t?Object.assign(r,e):r)},y=t=>{t._editing=!0},R=t=>{if(c(t))return m(t);for(const e in t._origin)t[e]=t._origin[e];t._editing=!1},m=t=>{t._delete=!0},S=t=>{t._editing=!1},T=t=>{const e={_editing:!0,...t??null,_origin:t?g(t):void 0};return l({data:i.data.concat(e)}),e},E=(t,e,r=!0)=>{const n=d(i).data,a=n.length-1;if(!(!r&&(e<0||e>a))){for(let s=0;s<=a;s++)if(n[s]===t){const o=r?s+e:e,f=Math.max(Math.min(o,a),0),_=n.slice(0,s).concat(n.slice(s+1));_.splice(f,0,n[s]),l({data:_});break}}},k=t=>!!t._editing,c=t=>p(t._origin),q=()=>{const t=[],e=[],r=[];for(const n of i.data)if(n._delete)c(n)||r.push(d(n));else if(c(n))t.push(d(n));else for(const a in n._origin)if(!A(n[a],n._origin[a])){e.push(d(n));break}return[r,t,e]},w=F(()=>{const t=d(i);return{...t,data:t.data.filter(e=>!e._delete)}});return{...b,tableState:w,setColumn:h,editRow:y,delRow:m,cancelRow:R,saveRow:S,addRow:T,rowIsEditing:k,getChangedRows:q,rowIsAdded:c,setState:t=>{if(Array.isArray(t.data))for(const e of t.data)e._origin=e._origin??g(e);l(t)},moveRow:E}};export{U as u};
//# sourceMappingURL=index-cd4d7396.js.map
