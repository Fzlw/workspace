import{u as q,d as x}from"./index-3751c747.js";import{Y as C,Z as v,O as A}from"./el-message-box-5b1e6d94.js";import{Q as I,g as O,u as d}from"./vue.esm-bundler-2b92b106.js";import{c as m}from"./cloneDeep-2d0ab0a3.js";const Y=u=>{const{tableState:i,setState:l,...p}=q({mapColumn(t){const{formatter:e,editable:r,...n}=t;return{...n,formatter(a,s,o,f){return(C(r)||r===!0)&&a._editing?v(a,t)??"":e?e(a,s,o,f):x(o,n.rFormat,n.defaultValue)??o??n.defaultValue}}},...u,async query(t){if(!u.query)return{list:[]};const e=await u.query(t);return e.list=e.list.map(r=>{const n=m(r);return Object.assign(r,{_origin:I(n)})}),e}}),b=(t,e)=>{i.columns=i.columns.map(r=>r.prop===t?Object.assign(r,e):r)},h=t=>{t._editing=!0},y=t=>{if(c(t))return g(t);for(const e in t._origin)t[e]=t._origin[e];t._editing=!1},g=t=>{t._delete=!0},R=t=>{t._editing=!1},S=t=>{const e={_editing:!0,...t??null,_new:!0,_origin:t?m(t):void 0};return l({data:i.data.concat(e)}),e},w=(t,e,r=!0)=>{const n=d(i).data,a=n.length-1;if(!(!r&&(e<0||e>a))){for(let s=0;s<=a;s++)if(n[s]===t){const o=r?s+e:e,f=Math.max(Math.min(o,a),0),_=n.slice(0,s).concat(n.slice(s+1));_.splice(f,0,n[s]),l({data:_});break}}},T=t=>!!t._editing,c=t=>t._new===!0,E=()=>{const t=[],e=[],r=[];for(const n of i.data)if(n._delete)c(n)||r.push(d(n));else if(c(n))t.push(d(n));else for(const a in n._origin)if(!A(n[a],n._origin[a])){e.push(d(n));break}return[r,t,e]},k=O(()=>{const t=d(i);return{...t,data:t.data.filter(e=>!e._delete)}});return{...p,tableState:k,setColumn:b,editRow:h,delRow:g,cancelRow:y,saveRow:R,addRow:S,rowIsEditing:T,getChangedRows:E,rowIsAdded:c,setState:t=>{if(Array.isArray(t.data))for(const e of t.data)e._origin=e._origin??m(e);l(t)},moveRow:w}};export{Y as u};
//# sourceMappingURL=index-5a6059d6.js.map
