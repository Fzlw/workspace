{"version":3,"file":"index-2cd541c7.js","sources":["../../../packages/component/src/useFormDialog/index.ts"],"sourcesContent":["import { computed, ref, watch } from 'vue'\nimport { useForm, UseFormOptions, SubmitPost, IFormColumn as FormColumn } from '../useForm'\nimport { FormDialogProps } from '../FormDialog'\n\nexport type UseFormDialogOptions<T> = UseFormOptions<T> & {\n  post?: SubmitPost<T>\n  onClose?: VoidFunction\n  onOpen?: VoidFunction\n}\n\nexport function useFormDialog<T extends object>(opts: UseFormDialogOptions<T>) {\n  const { formState, getModel, ...other } = useForm<T>(opts)\n  const visible = ref(false)\n  const dialogProps = ref({})\n\n  const submit = (post?: SubmitPost<T>) => {\n    return other.submit(async (model) => {\n      // FIXME: 快速点击情况下 当提交结束关闭弹窗过程中会再次触发\n      visible.value && post && (await post(model))\n\n      hide()\n    })\n  }\n\n  const onUpdateModelValue = (val: boolean) => {\n    visible.value = val\n    !val && (dialogProps.value = {})\n  }\n  const onSubmit = () => submit(opts.post)\n\n  const formDialogState = computed(() => {\n    return {\n      formState,\n      visible: visible.value,\n      submitting: formState.submitting,\n      'onUpdate:modelValue': onUpdateModelValue,\n      onSubmit,\n      ...dialogProps.value,\n    }\n  })\n\n  const show = (props?: Partial<FormDialogProps> & { onSubmit?: () => Promise<void> }) => {\n    props && (dialogProps.value = props)\n    visible.value = true\n  }\n\n  const hide = () => {\n    visible.value = false\n  }\n\n  watch(visible, (val) => {\n    val ? opts.onOpen?.() : opts.onClose?.()\n  })\n\n  const forEachColumns = (cb: (i: FormColumn, index: number, arr: FormColumn[]) => void) =>\n    formState.columns.forEach(cb)\n\n  return {\n    ...other,\n    formDialogState,\n    show,\n    hide,\n    submit,\n    getModel: getModel as <K extends keyof T = keyof T>(_k: K) => T[K],\n    forEachColumns,\n  }\n}\n"],"names":["useFormDialog","opts","formState","getModel","other","useForm","visible","ref","dialogProps","submit","post","model","hide","onUpdateModelValue","val","onSubmit","formDialogState","computed","show","props","watch","_a","_b","cb"],"mappings":"mGAUO,SAASA,EAAgCC,EAA+B,CAC7E,KAAM,CAAE,UAAAC,EAAW,SAAAC,EAAU,GAAGC,CAAM,EAAIC,EAAWJ,CAAI,EACnDK,EAAUC,EAAI,EAAK,EACnBC,EAAcD,EAAI,CAAA,CAAE,EAEpBE,EAAUC,GACPN,EAAM,OAAO,MAAOO,GAAU,CAEnCL,EAAQ,OAASI,GAAS,MAAMA,EAAKC,CAAK,EAErCC,GAAA,CACN,EAGGC,EAAsBC,GAAiB,CAC3CR,EAAQ,MAAQQ,EACf,CAAAA,IAAQN,EAAY,MAAQ,CAAC,EAAA,EAE1BO,EAAW,IAAMN,EAAOR,EAAK,IAAI,EAEjCe,EAAkBC,EAAS,KACxB,CACL,UAAAf,EACA,QAASI,EAAQ,MACjB,WAAYJ,EAAU,WACtB,sBAAuBW,EACvB,SAAAE,EACA,GAAGP,EAAY,KAAA,EAElB,EAEKU,EAAQC,GAA0E,CACtFA,IAAUX,EAAY,MAAQW,GAC9Bb,EAAQ,MAAQ,EAAA,EAGZM,EAAO,IAAM,CACjBN,EAAQ,MAAQ,EAAA,EAGZ,OAAAc,EAAAd,EAAUQ,GAAQ,SACtBA,GAAMO,EAAApB,EAAK,SAAL,MAAAoB,EAAA,KAAApB,IAAkBqB,EAAArB,EAAK,UAAL,MAAAqB,EAAA,KAAArB,EAAe,CACxC,EAKM,CACL,GAAGG,EACH,gBAAAY,EACA,KAAAE,EACA,KAAAN,EACA,OAAAH,EACA,SAAAN,EACA,eAVsBoB,GACtBrB,EAAU,QAAQ,QAAQqB,CAAE,CAS5B,CAEJ"}